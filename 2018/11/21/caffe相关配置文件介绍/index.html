<!DOCTYPE html>
<html lang="">
  <head><meta name="generator" content="Hexo 3.8.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">

<meta name="theme-color" content="#f8f5ec">
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="Caffe相关配置文件介绍">




  <meta name="keywords" content="Caffe, 磊哥的小书桌">










  <link rel="alternate" href="/default" title="磊哥的小书桌">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.10.1">



<link rel="canonical" href="https://geolibra.github.io/2018/11/21/caffe相关配置文件介绍/">



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css">




  <link rel="stylesheet" type="text/css" href="/lib/nprogress/nprogress.min.css">



<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.10.1">



  <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?97659041a2db55d3eb7266f53be7c071";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>


  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>





  <script src="//cdn1.lncld.net/static/js/3.1.1/av-min.js"></script>
  <script id="leancloud">
    AV.init({
      appId: "ro3TOe5F5DDemxHnSoYVCHli-gzGzoHsz",
      appKey: "IHyD5EfrggPl57FnwtBEeH0W"
    });
  </script>




<script>
  window.config = {"title":"磊哥的小书桌","subtitle":null,"description":null,"author":"hgis","language":null,"timezone":null,"url":"https://geolibra.github.io","root":"/","permalink":":year/:month/:day/:title/","permalink_defaults":null,"source_dir":"source","public_dir":"public","tag_dir":"tags","archive_dir":"archives","category_dir":"categories","code_dir":"downloads/code","i18n_dir":":lang","skip_render":null,"new_post_name":":title.md","default_layout":"post","titlecase":false,"external_link":true,"filename_case":0,"render_drafts":false,"post_asset_folder":true,"relative_link":false,"future":true,"highlight":{"enable":true,"auto_detect":false,"line_number":true,"tab_replace":null,"first_line_number":"always1"},"default_category":"uncategorized","category_map":null,"tag_map":null,"date_format":"YYYY-MM-DD","time_format":"HH:mm:ss","per_page":10,"pagination_dir":"page","theme":"even","deploy":{"type":"git","repository":"git@github.com:GeoLibra/GeoLibra.github.io.git","branch":"master"},"ignore":[],"keywords":null,"email":"674530915@qq.com","index_generator":{"per_page":10,"order_by":"-date","path":""},"tag_cloud":{"textFont":"Trebuchet MS, Helvetica","textColour":"\\#eea849","textHeight":25,"outlineColour":"\\#E2E1D1"},"category_generator":{"per_page":10},"archive_generator":{"per_page":10,"yearly":true,"monthly":true,"daily":false},"tag_generator":{"per_page":10},"marked":{"gfm":true,"pedantic":false,"sanitize":false,"tables":true,"breaks":true,"smartLists":true,"smartypants":true,"modifyAnchors":"","autolink":true},"server":{"port":4000,"log":false,"compress":false,"header":true},"since":2018,"favicon":"/favicon.ico","rss":"default","menu":{"Home":"/","Archives":"/archives/","Tags":"/tags","Categories":"/categories","About":"/about"},"color":"default","mode":"default","toc":true,"fancybox":true,"pjax":true,"copyright":{"enable":true,"license":"<a rel=\"license\" href=\"http://creativecommons.org/licenses/by-nc/4.0/\" target=\"_blank\">知识共享署名-非商业性使用 4.0 国际许可协议</a>"},"reward":{"enable":false,"qrCode":{"wechat":null,"alipay":null}},"social":{"email":"674530915@qq.com","stack-overflow":null,"twitter":null,"facebook":null,"linkedin":null,"google":null,"github":"https://github.com/GeoLibra","weibo":null,"zhihu":null,"douban":null,"pocket":null,"tumblr":null,"instagram":null},"leancloud":{"app_id":"ro3TOe5F5DDemxHnSoYVCHli-gzGzoHsz","app_key":"IHyD5EfrggPl57FnwtBEeH0W"},"baidu_analytics":"97659041a2db55d3eb7266f53be7c071","baidu_verification":null,"google_analytics":null,"google_verification":null,"disqus_shortname":null,"changyan":{"appid":null,"appkey":null},"livere_datauid":null,"counter":true,"version":"2.10.1"};
</script>

    <title> Caffe相关配置文件介绍 - 磊哥的小书桌 </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">磊哥的小书桌</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            首页
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            归档
          
        </li>
      </a>
    
      <a href="/tags">
        <li class="mobile-menu-item">
          
          
            标签
          
        </li>
      </a>
    
      <a href="/categories">
        <li class="mobile-menu-item">
          
          
            分类
          
        </li>
      </a>
    
      <a href="/about">
        <li class="mobile-menu-item">
          
          
            关于
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">磊哥的小书桌</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              首页
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              归档
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags">
            
            
              标签
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/categories">
            
            
              分类
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/about">
            
            
              关于
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          Caffe相关配置文件介绍
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2018-11-21
        </span>
        
          <span class="post-category">
            
              <a href="/categories/深度学习/">深度学习</a>
            
          </span>
        
        
        <span class="post-visits" data-url="/2018/11/21/caffe相关配置文件介绍/" data-title="Caffe相关配置文件介绍">
          阅读次数 0
        </span>
        
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#caffe基本概念"><span class="toc-text">caffe基本概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#solver-prototxt文件"><span class="toc-text">solver.prototxt文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据层参数"><span class="toc-text">数据层参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#视觉层参数"><span class="toc-text">视觉层参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Convolution层"><span class="toc-text">Convolution层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pooling层"><span class="toc-text">Pooling层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BN层"><span class="toc-text">BN层</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#激活层"><span class="toc-text">激活层</span></a></li></ol>
    </div>
  </div>



    <div class="post-content">
      
        <h2 id="caffe基本概念"><a href="#caffe基本概念" class="headerlink" title="caffe基本概念"></a>caffe基本概念</h2><p>在Caffe中，最基本的计算节点是层（Layer），所有计算关系都是基于层的。</p>
<ul>
<li>层（Layer）</li>
<li>网络（Net）</li>
<li>数据（Blob）</li>
<li>梯度下降（Solver）</li>
</ul>
<p>Caffe采用ptototxt文件来村塾网络结构和训练参数，并将网络参数存储在caffemodel文件中。以命令行方法启动Caffe训练，命令如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sh caffe train --solver=solver.prototxt</span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<h2 id="solver-prototxt文件"><a href="#solver-prototxt文件" class="headerlink" title="solver.prototxt文件"></a>solver.prototxt文件</h2><p>solver.prototxt文件是用来告诉caffe如何训练网络的。<br>caffe提供了6中优化算法，在solver配置文中中通过设置type类型来选择。  </p>
<ul>
<li>Stochastic Gradient Descent (type: “SGD”)，默认该优化方法，可以省略不写</li>
<li>AdaDelta (type: “AdaDelta”)</li>
<li>Adaptive Gradient (type: “AdaGrad”)</li>
<li>Adam (type: “Adam”)</li>
<li>Nesterov’s Accelerated Gradient (type: “Nesterov”) </li>
<li>RMSprop (type: “RMSProp”)</li>
</ul>
<p>solver流程:  </p>
<ol>
<li>设计好要优化对象以及用于学习的训练网络、用于评估测试的网络</li>
<li>通过forward和backward迭代进行优化来更新参数</li>
<li>定期评价测试网络（可以设定多少次训练后进行一次测试）</li>
<li>在优化过程中显示模型和solver的状态</li>
</ol>
<p>在每一次迭代中，solver做了一下工作：  </p>
<ol>
<li>调用forward来计算最终的输出值以及对应的loss</li>
<li>调用backward来计算每层的梯度</li>
<li>根据选用的solver方法，利用梯度进行参数更新</li>
<li>记录并保存每次迭代的学习率、快照以及对应的状态</li>
</ol>
<p>示例文件如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">net: <span class="string">"/media/hl/新加卷/mycode/SegNet/SegNet/Models/segnet_train.prototxt"</span> </span><br><span class="line">test_initialization: <span class="literal">false</span></span><br><span class="line">test_iter: 1 <span class="comment">#测试迭代次数</span></span><br><span class="line">test_interval: 10000000 <span class="comment"># 测试间隔</span></span><br><span class="line">base_lr: 0.001 <span class="comment"># 基础学习率</span></span><br><span class="line">lr_policy: <span class="string">"step"</span> <span class="comment"># 学习率变化规律</span></span><br><span class="line">gamma: 1.0 <span class="comment"># 学习率变化指数</span></span><br><span class="line">stepsize: 10000000 <span class="comment"># 学习率变化频率</span></span><br><span class="line">display: 20 <span class="comment"># 屏幕日志显示间隔,设置为0就不显示</span></span><br><span class="line">momentum: 0.9 <span class="comment"># 动量</span></span><br><span class="line">max_iter: 40000 <span class="comment"># 最大迭代次数</span></span><br><span class="line">weight_decay: 0.0005 <span class="comment"># 权值衰减,防止过拟合</span></span><br><span class="line">snapshot: 1000 <span class="comment"># 保存model的间隔</span></span><br><span class="line">snapshot_prefix: <span class="string">"/media/hl/新加卷/mycode/SegNet/SegNet/Models/Training/segnet"</span>  </span><br><span class="line">snapshot_diff: <span class="literal">true</span> <span class="comment"># 是否保存梯度值，默认为false,不保存</span></span><br><span class="line">snapshot_format: HDF5 <span class="comment"># 保存的类型,HDF5和BINARYPROTO,默认为BINARYPROTO</span></span><br><span class="line">solver_mode: GPU <span class="comment">#默认GPU,若没有GPU需要改成CPU</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>net设置深度网络模型，每个模型就是一个net，需要在一个专门的配置文件中对net进行配置，每个net由许多layer组成。文件的路径要从caffe的根目录开始，其他配置也要求这样。<br>也可用train_net和test_net来对训练模型和测试模型分别设定。例如：</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">train_net: <span class="string">"/media/hl/新加卷/mycode/SegNet/SegNet/Models/segnet_train.prototxt"</span></span><br><span class="line">test_net: <span class="string">"/media/hl/新加卷/mycode/SegNet/SegNet/Models/segnet_test.prototxt"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>lr_policy学习率调整策略。</p>
<ul>
<li>fixed：保持base_lr不变</li>
<li>step：如果设置为step,则还需要设置一个stepsize, 返回base_lr*gamma^(floor(iter / stepsize)),其中iter表示当前的迭代次数</li>
<li>exp：返回base_lr * gamma ^ iter，iter为当前迭代次数</li>
<li>inv：如果设置为inv,还需要设置一个power, 返回base_lr <em> (1 + gamma </em> iter) ^ (- power)</li>
<li>multistep：如果设置为multistep,则还需要设置一个stepvalue。这个参数和step很相似，step是均匀等间隔变化，而multistep则是根据stepvalue值变化</li>
<li>poly：学习率进行多项式误差, 返回 base_lr (1 - iter/max_iter) ^ (power)</li>
<li>sigmoid：学习率进行sigmod衰减，返回 base_lr ( 1/(1 + exp(-gamma * (iter - stepsize))))<br>下面是生成solver文件的代码<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">path=<span class="string">'/media/hl/新加卷/mycode/SegNet/SegNet/Models/'</span></span><br><span class="line">solver_file=path+<span class="string">'segnet_solver.prototxt'</span>     <span class="comment">#solver文件保存位置</span></span><br><span class="line">solver=&#123;&#125;</span><br><span class="line">solver[<span class="string">'train_net'</span>]=<span class="string">'"'</span>+path+<span class="string">'segnet_train.prototxt"'</span>  <span class="comment"># 训练配置文件</span></span><br><span class="line">solver[<span class="string">'test_net'</span>]=<span class="string">'"'</span>+path+<span class="string">'segnet_val.prototxt"'</span>     <span class="comment"># 测试配置文件</span></span><br><span class="line">solver[<span class="string">'test_iter'</span>]=<span class="string">'1'</span>                  <span class="comment"># 测试迭代次数</span></span><br><span class="line">solver[<span class="string">'test_interval'</span>]=<span class="string">'782'</span>              <span class="comment"># 测试间隔</span></span><br><span class="line">solver[<span class="string">'base_lr'</span>]=<span class="string">'0.001'</span>                  <span class="comment"># 基础学习率</span></span><br><span class="line">solver[<span class="string">'display'</span>]=<span class="string">'20'</span>                    <span class="comment"># 屏幕日志显示间隔</span></span><br><span class="line">solver[<span class="string">'max_iter'</span>]=<span class="string">'40000'</span>                 <span class="comment"># 最大迭代次数</span></span><br><span class="line">solver[<span class="string">'lr_policy'</span>]=<span class="string">'"step"'</span>                 <span class="comment"># 学习率变化规律</span></span><br><span class="line">solver[<span class="string">'gamma'</span>]=<span class="string">'0.1'</span>                      <span class="comment"># 学习率变化指数</span></span><br><span class="line">solver[<span class="string">'momentum'</span>]=<span class="string">'0.9'</span>                   <span class="comment"># 动量</span></span><br><span class="line">solver[<span class="string">'weight_decay'</span>]=<span class="string">'0.0005'</span>            <span class="comment"># 权值衰减</span></span><br><span class="line">solver[<span class="string">'stepsize'</span>]=<span class="string">'10000000'</span>                 <span class="comment"># 学习率变化频率</span></span><br><span class="line">solver[<span class="string">'snapshot'</span>]=<span class="string">'1000'</span>                   <span class="comment"># 保存model间隔</span></span><br><span class="line">solver[<span class="string">'snapshot_prefix'</span>]=<span class="string">"snapshot"</span>       <span class="comment"># 保存的model前缀</span></span><br><span class="line">solver[<span class="string">'solver_mode'</span>]=<span class="string">'GPU'</span>                <span class="comment"># 是否使用gpu</span></span><br><span class="line">solver[<span class="string">'solver_type'</span>]=<span class="string">'SGD'</span>                <span class="comment"># 优化算法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_solver</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(solver_file, <span class="string">'w'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> sorted(solver.items()):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span>(type(value) <span class="keyword">is</span> str):</span><br><span class="line">                <span class="keyword">raise</span> TypeError(<span class="string">'所有参数必须是字符串'</span>)</span><br><span class="line">            f.write(<span class="string">'%s: %s\n'</span> % (key, value))</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    write_solver()</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h2 id="数据层参数"><a href="#数据层参数" class="headerlink" title="数据层参数"></a>数据层参数</h2><p>一个模型由多个layer构成，每个layer由许多参数组成。所有参数的定义都在prototxt的文件中。层有很多种类型，如Data、Convolution、Pooling，层之间的数据流动是以Blobs的方式进行。<br>数据层是每个模型的最底层，模型的入口，不仅提供数据的输入，也提供数据从Blobs转换成别的格式进行保存输出。通常数据预处理（如缩放、裁剪等），也在这一层设置参数实现。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">"data"</span></span><br><span class="line">  <span class="built_in">type</span>: <span class="string">"DenseImageData"</span></span><br><span class="line">  top: <span class="string">"data"</span></span><br><span class="line">  top: <span class="string">"label"</span></span><br><span class="line">  dense_image_data_param &#123;</span><br><span class="line">    <span class="built_in">source</span>: <span class="string">"/media/hl/新加卷/mycode/SegNet/SegNet/CamVid/train.txt"</span>	 <span class="comment"># 数据源地址</span></span><br><span class="line">    batch_size: 1   	<span class="comment"># 每次处理的个数		</span></span><br><span class="line">    shuffle: <span class="literal">true</span>       % 随机打乱顺序,默认值为<span class="literal">false</span></span><br><span class="line">    new_height: 256</span><br><span class="line">    new_width: 256</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>name:该层的名称</li>
<li>type:层类型,根据数据来源不同,数据层的类型也不同</li>
<li>top/bottom:每一层用bottom来输入数据,用top来输出数据.如果只有top没有bottom,则此层只有输出没有输入。如果有多个top或多个bottom，表示有多个blobs数据的输入和输出。</li>
<li>data与label:zai在数据层中，至少有一个名为data的top，=如果有第二个top，一般命名为label。这种(data,label)配对是分类模型所必须的。</li>
<li>new_height,new_width: 如果设置，则将图片进行resize</li>
</ul>
<h2 id="视觉层参数"><a href="#视觉层参数" class="headerlink" title="视觉层参数"></a>视觉层参数</h2><h3 id="Convolution层"><a href="#Convolution层" class="headerlink" title="Convolution层"></a>Convolution层</h3><p>卷积层，层类型为Convolution。</p>
<ul>
<li>lr_mult:学习率系数,最终的学习率是这个数乘以solver文件中base_lr。如果有两个lr_mult，则第一个表示权值的学习率，第二个表示偏置项的学习率。一般偏置项的学习率是权值学习率的两倍。</li>
<li>在后面的convolution_param中，可以设定卷积层的特有参数。<ul>
<li>必选参数:<ul>
<li>num_output: 卷积核（filter)的个数</li>
<li>kernel_size: 卷积核的大小。如果卷积核的长和宽不等，需要用kernel_h和kernel_w分别设定</li>
</ul>
</li>
<li>其他参数:<ul>
<li>stride: 卷积核的步长，默认为1。也可以用stride_h和stride_w来设置。</li>
<li>pad: 边缘填充，默认为0，不填充。</li>
<li>weight_filler: 权值初始化。默认为”constant”,值全为0。常量初始化（constant）、高斯分布初始化（gaussian）、positive_unitball初始化、均匀分布初始化（uniform）、xavier初始化、msra初始化、双线性初始化（bilinear）</li>
<li>bias_filler: 偏置项的初始化。一般设置为”constant”,值全为0。</li>
<li>bias_term: 是否开启偏置项，默认为true, 开启</li>
<li>group: 分组，默认为1组。如果大于1，我们限制卷积的连接操作在一个子集内。如果我们根据图像的通道来分组，那么第i个输出分组只能与第i个输入分组进行连接。</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">layer &#123;</span><br><span class="line">  bottom: <span class="string">"data"</span></span><br><span class="line">  top: <span class="string">"conv1_1"</span></span><br><span class="line">  name: <span class="string">"conv1_1"</span></span><br><span class="line">  <span class="built_in">type</span>: <span class="string">"Convolution"</span></span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: 1</span><br><span class="line">    decay_mult: 1</span><br><span class="line">  &#125;</span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: 2</span><br><span class="line">    decay_mult: 0</span><br><span class="line">  &#125;</span><br><span class="line">  convolution_param &#123;</span><br><span class="line">    weight_filler &#123;</span><br><span class="line">      <span class="built_in">type</span>: <span class="string">"msra"</span></span><br><span class="line">    &#125;</span><br><span class="line">    bias_filler &#123;</span><br><span class="line">      <span class="built_in">type</span>: <span class="string">"constant"</span></span><br><span class="line">    &#125;</span><br><span class="line">    num_output: 64</span><br><span class="line">    pad: 1</span><br><span class="line">    kernel_size: 3</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输入：n<em>c0</em>w0<em>h0<br>输出：n</em>c1<em>w1</em>h1<br>其中，c1就是参数中的num_output，生成的特征图个数<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">w1=(w0+2*pad-kernel_size)/stride+1;</span><br><span class="line">h1=(h0+2*pad-kernel_size)/stride+1;</span><br></pre></td></tr></table></figure></p>
<p>如果设置stride为1，前后两次卷积部分存在重叠。如果设置pad=(kernel_size-1)/2,则运算后，宽度和高度不变。</p>
<h3 id="Pooling层"><a href="#Pooling层" class="headerlink" title="Pooling层"></a>Pooling层</h3><p>必选参数：</p>
<ul>
<li>kernel_size: 池化的核大小。也可以用kernel_h和kernel_w分别设定。</li>
</ul>
<p>其它参数：</p>
<ul>
<li>pool: 池化方法，默认为MAX。目前可用的方法有MAX, AVE, 或STOCHASTIC</li>
<li>pad: 和卷积层的pad的一样，进行边缘扩充。默认为0</li>
<li>stride: 池化的步长，默认为1。一般我们设置为2，即不重叠。也可以用stride_h和stride_w来设置。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">layer &#123;</span><br><span class="line">  bottom: <span class="string">"conv1_2"</span></span><br><span class="line">  top: <span class="string">"pool1"</span></span><br><span class="line">  top: <span class="string">"pool1_mask"</span></span><br><span class="line">  name: <span class="string">"pool1"</span></span><br><span class="line">  <span class="built_in">type</span>: <span class="string">"Pooling"</span></span><br><span class="line">  pooling_param &#123;</span><br><span class="line">    pool: MAX</span><br><span class="line">    kernel_size: 2</span><br><span class="line">    stride: 2</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>输入：n<em>c</em>w0<em>h0<br>输出：n</em>c<em>w1</em>h1<br>和卷积层的区别就是其中的c保持不变<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">w1=(w0+2*pad-kernel_size)/stride+1;</span><br><span class="line">h1=(h0+2*pad-kernel_size)/stride+1;</span><br></pre></td></tr></table></figure></p>
<p>如果设置stride为2，前后两次卷积部分不重叠。100<em>100的特征图池化后，变成50</em>50</p>
<h2 id="BN层"><a href="#BN层" class="headerlink" title="BN层"></a>BN层</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">layer &#123;</span><br><span class="line">  bottom: <span class="string">"conv1_1"</span></span><br><span class="line">  top: <span class="string">"conv1_1"</span></span><br><span class="line">  name: <span class="string">"conv1_1_bn"</span></span><br><span class="line">  <span class="built_in">type</span>: <span class="string">"BN"</span></span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: 1</span><br><span class="line">    decay_mult: 1</span><br><span class="line">  &#125;</span><br><span class="line">  param &#123;</span><br><span class="line">    lr_mult: 1</span><br><span class="line">    decay_mult: 0</span><br><span class="line">  &#125;</span><br><span class="line">  bn_param &#123;</span><br><span class="line">	scale_filler &#123;</span><br><span class="line">	  <span class="built_in">type</span>: <span class="string">"constant"</span></span><br><span class="line">	  value: 1</span><br><span class="line">	&#125;</span><br><span class="line">	shift_filler &#123;</span><br><span class="line">	  <span class="built_in">type</span>: <span class="string">"constant"</span></span><br><span class="line">	  value: 0.001</span><br><span class="line">	&#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="激活层"><a href="#激活层" class="headerlink" title="激活层"></a>激活层</h2><p>从bottom得到一个blob数据输入，运算后，从top输出一个blob数据。<br>常用的激活函数有sigmoid, tanh,relu等<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">layer &#123;</span><br><span class="line">  bottom: <span class="string">"conv1_1"</span></span><br><span class="line">  top: <span class="string">"conv1_1"</span></span><br><span class="line">  name: <span class="string">"relu1_1"</span></span><br><span class="line">  <span class="built_in">type</span>: <span class="string">"ReLU"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
      
      

  <div class="post-copyright">
    <p class="copyright-item">
      <span>原文作者: </span>
      <a href="https://geolibra.github.io">hgis</a>
    </p>
    <p class="copyright-item">
      <span>原文链接: </span>
      <a href="https://geolibra.github.io/2018/11/21/caffe相关配置文件介绍/">https://geolibra.github.io/2018/11/21/caffe相关配置文件介绍/</a>
    </p>
    <p class="copyright-item">
      <span>许可协议: </span>
      
      <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>
    </p>
  </div>



      
      
    

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/Caffe/">Caffe</a>
            
          </div>
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2018/11/21/Batch-Normalization/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">Batch Normalization</span>
        <span class="prev-text nav-mobile">上一篇</span>
      </a>
    
    
      <a class="next" href="/2018/11/20/caffe-segnet-配置使用/">
        <span class="next-text nav-default">caffe-segnet 配置使用</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>


      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
  </div>


        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:674530915@qq.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a href="https://github.com/GeoLibra" class="iconfont icon-github" title="github"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    
      
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>


<div class="copyright">
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  <span class="post-meta-divider">|</span>
  <span id="busuanzi_container_site_uv">本站访客数<span id="busuanzi_value_site_uv"></span>人</span>


  <span class="copyright-year">
    
    &copy; 
     
      2018 - 
    
    2019

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">hgis</span>
    <span id="busuanzi_container_site_uv">
    </span>
</span>
</div>



      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  
  

  



    
  



  
  





  
    <script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  

  
    <script type="text/javascript" src="/lib/pjax/jquery.pjax.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/nprogress/nprogress.min.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=2.10.1"></script>

  </body>
</html>
